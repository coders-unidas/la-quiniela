<!DOCTYPE html>
<html>
     <head>

<title> Model Analysis</title>
</head>
<font face=”Arial”>

<body marginwidth="50">
<center>
    <h1 style="font-family: 'Arial', sans-serif;"> Model Analysis </h1> 
    <h3 style="font-family: 'Arial', sans-serif;"> Authors: </h3>
      <p style="font-family: 'Arial', sans-serif;">Elisa Etzkorn Ferran </p> 
      <p style="font-family: 'Arial', sans-serif;">Sofia Llàcer Caro</p>
      <p style="font-family: 'Arial', sans-serif;">Nerea Río Grela</p>
</center>
<hr>
<h2 style="font-family: 'Arial', sans-serif;"> 1. Introduction</h2>
<p style="text-align: justify; font-family: 'Arial', sans-serif;"> The aim of this project is to develop a machine learning model 
simulating a <em>Quiniela</em> game using historical data from <em>LaLiga</em>. The model can give you the predictions
of the results of the matches for a given match day in a certain division and season.
</p>

<p style="text-align: justify; font-family: 'Arial', sans-serif;">
The main objective is to give the model <em>features</em> so they can predict an outcome, called <em>target</em>. The model 
is trained with data from those <em>features</em> and in which <em>target</em> did they result. Once the model is trained, 
if new <em>features</em> are introduced, it will predict a certain <em>target</em>.

</p>

<p style="text-align: justify; font-family: 'Arial', sans-serif;"> In the case of this project, the <em>target</em> will be whether the home team
wins, loses or if there is a tie. The outcome of the program will be: 1 if the home team wins, 2 if the away team wins  or <em>X</em>
if there is a tie. In order to see the performance of the model, matches which the score is already already known can be predicted,
so the prediction can be compared with the reality and establish the reliability of the model. </p>
<hr\>

<h2 style="text-align: justify; font-family: 'Arial', sans-serif;">2. Description of the model</h2>
<h3 style="text-align: justify; font-family: 'Arial', sans-serif;"> 2.1 Features </h3>
<p style="text-align: justify; font-family: 'Arial', sans-serif;"> We have established three candidate features for our model that are
     features related to the outcome of the matches. 
     
<p style="text-align: justify; font-family: 'Arial', sans-serif;"> Firstly, something that is quite related to which team has more
      odds of winning a match is how high or low are they in the rank position; the higher a team is positioned
       in the rank means that in the past they performed really well. So, thinking that a team with a higher rank playing against
       a team with a lower rank will win, is quite a safe bet. This is the logic between why we chose the following features: the rank 
       position from the latter season and the rank position in the current season each day (in other words, how are they positioned 
       in the rank a certain day of the season according to the matches until that day). To take into consideration the division shifts,
       we established that the rank position in division 2 is <em>N</em>+<em>n</em> (the last rank position in division 1 of the season
       plus the rank position of the team in division 2).
</p>

<p style="text-align: justify; font-family: 'Arial', sans-serif;"> The third feature that we considered is the matchday. On its own,
it's not really relevant to the outcome of the match, but it is helpful compensating the values of the rank position in the current season
each day. If we didn't introduced this term, the rank position in the current position in the first days of the season (when there
is not a lot of information) would have a similar weight than the one in the last days of the season (when there is more information
and the feature is much more useful). </p>
<h4 style="text-align: justify; font-family: 'Arial', sans-serif;"> 2.1.1 Codes to study the suitability of the features</h4>

<p style="text-align: justify; font-family: 'Arial', sans-serif;">In order to choose which features we chose to develop the model, we
wrote three codes in Jupyter Notebook that can be found in the folder <em>analysis</em>. We tried to execute them with the same data,
and we tried to predict the outcome of matches. We already know the results, so we compared what the model predicted with the reality
to study the performance of each code and find the better option. </p>
<p style="text-align: justify; font-family: 'Arial', sans-serif;">The first code is called <em>first_model_matchday.ipynb</em>,
and, in there, we trained the model with just information of the ranking of the current season with the match day. The second code, 
<em>second_model_season.ipynb</em> is trained with just the rank position of the previous season. Finally, the third code 
<em>third_model_both.ipynb</em> is trained with all the features.  </p> 
 <h4 style="text-align: justify; font-family: 'Arial', sans-serif;"> 2.1.2 Performance of the models</h4>

<p style="text-align: justify; font-family: 'Arial', sans-serif;">In order to establish a fair comparison,
     all of the codes are trained with data from the season 2000-2001 to the season 2019-2020, and we predicted and compared
     the predictions with the real results with data from the season 2020-2021.In Figure 1 there is displayed a graphic that 
     shows the performance of the three codes. </p>
<center>
     <figure><img src="images_forhtml/performance.png" alt="graphic with performance">  
          <figcaption style="font-family: 'Arial', sans-serif;">
          Figure 1: Plot bar that shows the percentage of success of the three codes.
     </figcaption> </figure> </center>

     <p style="text-align: justify; font-family: 'Arial', sans-serif;">At first glance, it can be seen that the performance is quite 
     similar in the three codes, so we can see that the three set of features would be good choices. However, the one that shows the 
     greater percentage of success is the second code. Due to this, we chose as features for our definite model the rank from 
     the previous season.</p>

<h3 style="text-align: justify; font-family: 'Arial', sans-serif;"> 2.2 Notebook of the model </h3>


<h3 style="text-align: justify; font-family: 'Arial', sans-serif;"> 2.3 Converting the notebook into the already functional software </h3>
<p style="text-align: justify; font-family: 'Arial', sans-serif;">
The software consists on 4 codes that are connected between each other, and each one has a certain role in the performance of the 
model. Here below, the 4 codes and their roles are described.

</p>
<h4 style="text-align: justify; font-family: 'Arial', sans-serif;"> 2.3.1 First code: <em>transform_data.py</em> </h4>
<p style="text-align: justify; font-family: 'Arial', sans-serif;"> This code was not in the initial codes given at the beginning 
     of the project. Its main goal is to, as it's implied in its name, to transform the data from the given data frame so we 
     could obtain the data from the features that we needed to implement in our model. It is very similar to the exercise 7 of 
     the <em>data_analysis.ipynb</em>, in which a ranking is given to all of the teams for each season. After that the ranking is added to the structure 
     from the initial database, where each row corresponds to a match and not a single team.
</p>
<h4 style="text-align: justify; font-family: 'Arial', sans-serif;"> 2.3.2 Second code: <em>models.py</em> </h4>
<p style="text-align: justify; font-family: 'Arial', sans-serif;"> 
     In this file, the class <em>QuinielaModel</em> which will store the model is defined, with two functions, one to train the model (meaning itself) and
     the other to predict the outcome of the matches. Here is where the features and target are defined and the model from skilearn is implemented.
</p>

<h4 style="text-align: justify; font-family: 'Arial', sans-serif;"> 2.3.3 Third code: <em>io.py</em> </h4>
<p style="text-align: justify; font-family: 'Arial', sans-serif;"> 
     This file defines three different functions, each conected to the database <em>laliga.sqlite</em>, one to load the data for training the model, another to load the data for the model
     to predict and the last one to safe the predictions in the database.
</p>



<hr\>
<h2 style="text-align: justify; font-family: 'Arial', sans-serif;">3. Performance of the chosen model</h2>
<p style="text-align: justify; font-family: 'Arial', sans-serif;">In order to study the performance of the chosen model we tried to study
in more its predictions and their veracity. We tried to predict the outcome of the result of the season 2020-2021 training the model starting 
with different seasons to season 2019-2020. In Figure 2 there is a graphic with the results obtained.</p>
<center>
     <figure><img src="images_forhtml/perf.png" alt="graphic with performance">  
          <figcaption style="font-family: 'Arial', sans-serif;">
          Figure 2: Scatter plot that shows the performance of the code starting the training of the model on several seasons.
     </figcaption> </figure> </center>
     <p style="text-align: justify; font-family: 'Arial', sans-serif;">As it can be seen in the graphic above, the model performs better
          when being trained with data from less seasons. The difference in performance is not abysmal, but there is an improvement.
     </p>
     <p style="text-align: justify; font-family: 'Arial', sans-serif;">One conclusion that we arrived when studying the data in the 
          <em>Data Analysis</em> is that there's a tendency for the home team to win more times than the away team, as it can be 
          seen in the pie chart in Figure 3.
     </p>
     <center>
          <figure><img src="images_forhtml/hometeamvsawayteam.png" alt="piechart">  
               <figcaption style="font-family: 'Arial', sans-serif;">
               Figure 3: Pie chart that shows in the history of <em>LaLiga</em> the percentage of times the home team wins, the away team wins
               or if there is a tie.
          </figcaption> </figure> </center>

     <p style="text-align: justify; font-family: 'Arial', sans-serif;">In order to see if this fact affected much the predictions of our
          model, we calculated the percentage of times that the model predicted that home team would win. In Figure 4 there are 
          the results we found. 
     </p>
     <center>
          <figure><img src="images_forhtml/homewins.png" alt="graphic with home wins">  
               <figcaption style="font-family: 'Arial', sans-serif;">
               Figure 4: Scatter plot that shows the percentage of times the model predicts the home team wins starting the training of 
               the model on several seasons.
          </figcaption> </figure> </center>
          <p style="text-align: justify; font-family: 'Arial', sans-serif;"> As it can be seen in the figure above, there is a strong bias
               torwards predicting the home team wins. A noticeable thing that can be observed is that this bias is weaker when dealing
               with less data, which maybe explains that the model performs better in those conditions.

          </p>  


<h2 style="text-align: justify; font-family: 'Arial', sans-serif;">4. Conclusions</h2>

<p style="text-align: justify; font-family: 'Arial', sans-serif;"> We can conclude that the model, eventhough it probably won't make anybody
     rich, works quite well since the worst performance that we observed is around 44% of success. 
</p>

<p style="text-align: justify; font-family: 'Arial', sans-serif;">First of all, the choice of features wasn't the one we first
     expected. We thought that a bigger number of features would bring the best results, but every test would result into a better 
     performance of the model we chose. One possible explanation can be that maybe implementing the feature matchday 
     doesn't really compensate the error that maybe can be brought by the rank of the season in the current day. </p> 

<p style="text-align: justify; font-family: 'Arial', sans-serif;">Another thing that we observed is that the model works best when dealing
with less amount of data. Something that can affect this is that when the model is trained with more data, the bias torwards
predicting that the home team will win is stronger. Another explanation is that, with a larger number of seasons, the probability
of having teams with a rank position from the previous season with 0 increases. This fact can bring uncertainty to the model
and, therefore, less reliability.</p>

</font>
</body>
</html>